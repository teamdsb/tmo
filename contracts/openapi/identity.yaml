openapi: 3.1.0
info:
  title: Procurement Mini Program - Identity API
  version: 0.1.0
  description: |
    v1 API contract for customer/staff mini programs + Admin Web.
    Conventions:
    - JSON field naming: camelCase
    - Time: RFC3339 date-time strings
    - IDs: UUID strings
    - Auth: Bearer JWT access token
    - Idempotency: send `Idempotency-Key` for order submit and payment create
servers:
- url: https://api.example.com
tags:
- name: Auth
- name: Me
- name: RBAC
- name: Staff
- name: Audit
- name: Customers
security:
- bearerAuth: []
paths:
  "/auth/mini/login":
    post:
      tags:
      - Auth
      summary: Mini program login (customer/staff, WeChat/Alipay)
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/MiniLoginRequest"
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/AuthResponse"
        '400':
          "$ref": "#/components/responses/BadRequest"
        '409':
          "$ref": "#/components/responses/Conflict"
  "/auth/password/login":
    post:
      tags:
      - Auth
      summary: Admin web password login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/PasswordLoginRequest"
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/AuthResponse"
        '400':
          "$ref": "#/components/responses/BadRequest"
        '401':
          "$ref": "#/components/responses/Unauthorized"
  "/me":
    get:
      tags:
      - Me
      summary: Get current user
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/User"
        '401':
          "$ref": "#/components/responses/Unauthorized"
  "/me/sales-qr-code":
    get:
      tags:
      - Me
      summary: Get sales binding QR code (sales only)
      parameters:
      - in: query
        name: platform
        required: false
        schema:
          type: string
          enum:
          - weapp
          - alipay
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/SalesQrCode"
  "/me/permissions":
    get:
      tags:
      - Me
      summary: Get effective permissions for current user
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/PermissionList"
        '401':
          "$ref": "#/components/responses/Unauthorized"
  "/rbac/permissions":
    get:
      tags:
      - RBAC
      summary: List permission codes
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/PermissionCatalog"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '403':
          "$ref": "#/components/responses/Forbidden"
    post:
      tags:
      - RBAC
      summary: Create or update a permission
      requestBody:
        required: true
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/PermissionCreateRequest"
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Permission"
        '400':
          "$ref": "#/components/responses/BadRequest"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '403':
          "$ref": "#/components/responses/Forbidden"
  "/rbac/roles":
    get:
      tags:
      - RBAC
      summary: List roles and permissions
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/RoleList"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '403':
          "$ref": "#/components/responses/Forbidden"
  "/rbac/roles/{role}/permissions":
    put:
      tags:
      - RBAC
      summary: Replace permissions for a role
      parameters:
      - in: path
        name: role
        required: true
        schema:
          type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/RolePermissionsUpdate"
      responses:
        '204':
          description: No Content
        '400':
          "$ref": "#/components/responses/BadRequest"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '403':
          "$ref": "#/components/responses/Forbidden"
        '404':
          "$ref": "#/components/responses/NotFound"
  "/rbac/authorize":
    post:
      tags:
      - RBAC
      summary: Evaluate permission for current user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/AuthorizeRequest"
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/AuthorizeResponse"
        '400':
          "$ref": "#/components/responses/BadRequest"
        '401':
          "$ref": "#/components/responses/Unauthorized"
  "/staff":
    post:
      tags:
      - Staff
      summary: Create staff user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/CreateStaffRequest"
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/StaffUser"
        '400':
          "$ref": "#/components/responses/BadRequest"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '403':
          "$ref": "#/components/responses/Forbidden"
    get:
      tags:
      - Staff
      summary: List staff users
      parameters:
      - in: query
        name: page
        schema:
          type: integer
          minimum: 1
      - in: query
        name: pageSize
        schema:
          type: integer
          minimum: 1
          maximum: 100
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/PagedStaffList"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '403':
          "$ref": "#/components/responses/Forbidden"
  "/staff/{staffId}":
    get:
      tags:
      - Staff
      summary: Get staff user
      parameters:
      - in: path
        name: staffId
        required: true
        schema:
          type: string
          format: uuid
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/StaffUser"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '403':
          "$ref": "#/components/responses/Forbidden"
        '404':
          "$ref": "#/components/responses/NotFound"
    patch:
      tags:
      - Staff
      summary: Update staff user
      parameters:
      - in: path
        name: staffId
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/UpdateStaffRequest"
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/StaffUser"
        '400':
          "$ref": "#/components/responses/BadRequest"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '403':
          "$ref": "#/components/responses/Forbidden"
        '404':
          "$ref": "#/components/responses/NotFound"
  "/staff/{staffId}/bindings":
    post:
      tags:
      - Staff
      summary: Create staff binding token
      parameters:
      - in: path
        name: staffId
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              "$ref": "#/components/schemas/CreateStaffBindingRequest"
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/StaffBindingToken"
        '400':
          "$ref": "#/components/responses/BadRequest"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '403':
          "$ref": "#/components/responses/Forbidden"
        '404':
          "$ref": "#/components/responses/NotFound"
  "/audit-logs":
    get:
      tags:
      - Audit
      summary: List audit logs
      parameters:
      - in: query
        name: actorUserId
        schema:
          type: string
          format: uuid
      - in: query
        name: action
        schema:
          type: string
      - in: query
        name: targetType
        schema:
          type: string
      - in: query
        name: page
        schema:
          type: integer
          minimum: 1
      - in: query
        name: pageSize
        schema:
          type: integer
          minimum: 1
          maximum: 100
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/PagedAuditLogList"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '403':
          "$ref": "#/components/responses/Forbidden"
  "/customers":
    get:
      tags:
      - Customers
      summary: List customers (scope by role)
      parameters:
      - in: query
        name: q
        schema:
          type: string
      - in: query
        name: ownerSalesUserId
        schema:
          type: string
          format: uuid
      - in: query
        name: page
        schema:
          type: integer
          minimum: 1
          default: 1
      - in: query
        name: pageSize
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/PagedCustomerList"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '403':
          "$ref": "#/components/responses/Forbidden"
  "/customers/{customerId}":
    get:
      tags:
      - Customers
      summary: Get customer detail
      parameters:
      - in: path
        name: customerId
        required: true
        schema:
          type: string
          format: uuid
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Customer"
        '401':
          "$ref": "#/components/responses/Unauthorized"
        '403':
          "$ref": "#/components/responses/Forbidden"
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            "$ref": "#/components/schemas/ErrorResponse"
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            "$ref": "#/components/schemas/ErrorResponse"
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            "$ref": "#/components/schemas/ErrorResponse"
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            "$ref": "#/components/schemas/ErrorResponse"
    NotFound:
      description: Not Found
      content:
        application/json:
          schema:
            "$ref": "#/components/schemas/ErrorResponse"
  schemas:
    ErrorResponse:
      "$ref": "./common.yaml#/components/schemas/ErrorResponse"
    MiniLoginRequest:
      "$ref": "./common.yaml#/components/schemas/MiniLoginRequest"
    PasswordLoginRequest:
      "$ref": "./common.yaml#/components/schemas/PasswordLoginRequest"
    AuthResponse:
      "$ref": "./common.yaml#/components/schemas/AuthResponse"
    User:
      "$ref": "./common.yaml#/components/schemas/User"
    Customer:
      type: object
      properties:
        id:
          type: string
          format: uuid
        displayName:
          type: string
        phone:
          type: string
          nullable: true
        ownerSalesUserId:
          type: string
          format: uuid
          nullable: true
        createdAt:
          type: string
          format: date-time
      required:
      - id
      - displayName
      - createdAt
    PagedCustomerList:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/Customer"
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
      required:
      - items
      - page
      - pageSize
      - total
    SalesQrCode:
      "$ref": "./common.yaml#/components/schemas/SalesQrCode"
    PermissionScope:
      type: string
      enum:
      - SELF
      - OWNED
      - ALL
    Permission:
      type: object
      properties:
        code:
          type: string
        description:
          type: string
      required:
      - code
    PermissionCatalog:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/Permission"
      required:
      - items
    EffectivePermission:
      type: object
      properties:
        code:
          type: string
        scope:
          "$ref": "#/components/schemas/PermissionScope"
      required:
      - code
      - scope
    PermissionList:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/EffectivePermission"
      required:
      - items
    RolePermission:
      type: object
      properties:
        code:
          type: string
        scope:
          "$ref": "#/components/schemas/PermissionScope"
      required:
      - code
      - scope
    Role:
      type: object
      properties:
        code:
          type: string
        userType:
          type: string
          enum:
          - customer
          - staff
          - admin
        description:
          type: string
        permissions:
          type: array
          items:
            "$ref": "#/components/schemas/RolePermission"
      required:
      - code
      - userType
      - permissions
    RoleList:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/Role"
      required:
      - items
    RolePermissionsUpdate:
      type: object
      properties:
        permissions:
          type: array
          items:
            "$ref": "#/components/schemas/RolePermission"
      required:
      - permissions
    PermissionCreateRequest:
      type: object
      properties:
        code:
          type: string
        description:
          type: string
      required:
      - code
    AuthorizeRequest:
      type: object
      properties:
        permission:
          type: string
        requiredScope:
          "$ref": "#/components/schemas/PermissionScope"
      required:
      - permission
    AuthorizeResponse:
      type: object
      properties:
        allowed:
          type: boolean
        effectiveScope:
          "$ref": "#/components/schemas/PermissionScope"
      required:
      - allowed
    StaffUser:
      type: object
      properties:
        id:
          type: string
          format: uuid
        displayName:
          type: string
        roles:
          type: array
          items:
            type: string
        status:
          "$ref": "./common.yaml#/components/schemas/UserStatus"
        disabledAt:
          type: string
          format: date-time
          nullable: true
        disabledReason:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
      - id
      - roles
      - status
      - createdAt
      - updatedAt
    CreateStaffRequest:
      type: object
      properties:
        displayName:
          type: string
        roles:
          type: array
          items:
            type: string
      required:
      - roles
    UpdateStaffRequest:
      type: object
      properties:
        displayName:
          type: string
        roles:
          type: array
          items:
            type: string
        status:
          "$ref": "./common.yaml#/components/schemas/UserStatus"
        disabledReason:
          type: string
          nullable: true
    PagedStaffList:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/StaffUser"
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
      required:
      - items
      - page
      - pageSize
      - total
    StaffBindingToken:
      type: object
      properties:
        token:
          type: string
        expiresAt:
          type: string
          format: date-time
          nullable: true
      required:
      - token
    CreateStaffBindingRequest:
      type: object
      properties:
        platform:
          type: string
          enum:
          - weapp
          - alipay
        expiresIn:
          type: integer
          minimum: 1
      required:
      - platform
    AuditLog:
      type: object
      properties:
        id:
          type: string
          format: uuid
        actorUserId:
          type: string
          format: uuid
          nullable: true
        action:
          type: string
        targetType:
          type: string
          nullable: true
        targetId:
          type: string
          format: uuid
          nullable: true
        metadata:
          type: object
          additionalProperties: true
        requestId:
          type: string
          nullable: true
        ip:
          type: string
          nullable: true
        userAgent:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
      required:
      - id
      - action
      - createdAt
    PagedAuditLogList:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/AuditLog"
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
      required:
      - items
      - page
      - pageSize
      - total
    Category:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        parentId:
          type: string
          format: uuid
          nullable: true
        sort:
          type: integer
          default: 0
      required:
      - id
      - name
    ProductSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        coverImageUrl:
          type: string
        categoryId:
          type: string
          format: uuid
        tags:
          type: array
          items:
            type: string
      required:
      - id
      - name
      - categoryId
    PagedProductList:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/ProductSummary"
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
      required:
      - items
      - page
      - pageSize
      - total
    PriceTier:
      type: object
      properties:
        minQty:
          type: integer
          minimum: 1
        maxQty:
          type: integer
          nullable: true
          description: null means no upper bound
        unitPrice:
          type: number
      required:
      - minQty
      - unitPrice
    SKU:
      type: object
      properties:
        id:
          type: string
          format: uuid
        spuId:
          type: string
          format: uuid
        skuCode:
          type: string
        name:
          type: string
        attributes:
          type: object
          additionalProperties:
            type: string
        priceTiers:
          type: array
          items:
            "$ref": "#/components/schemas/PriceTier"
        unit:
          type: string
          example: pcs
        isActive:
          type: boolean
          default: true
      required:
      - id
      - spuId
      - name
      - isActive
    ProductDetail:
      type: object
      properties:
        product:
          type: object
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
            description:
              type: string
            images:
              type: array
              items:
                type: string
            categoryId:
              type: string
              format: uuid
            filterDimensions:
              type: array
              description: For multi-level filtering, e.g., material -> length ->
                size
              items:
                type: string
          required:
          - id
          - name
          - categoryId
        skus:
          type: array
          items:
            "$ref": "#/components/schemas/SKU"
      required:
      - product
      - skus
    WishlistItem:
      type: object
      properties:
        sku:
          "$ref": "#/components/schemas/SKU"
        createdAt:
          type: string
          format: date-time
      required:
      - sku
      - createdAt
    CartItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        sku:
          "$ref": "#/components/schemas/SKU"
        qty:
          type: integer
          minimum: 1
      required:
      - id
      - sku
      - qty
    Cart:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/CartItem"
        updatedAt:
          type: string
          format: date-time
      required:
      - items
    AddCartItemRequest:
      type: object
      properties:
        skuId:
          type: string
          format: uuid
        qty:
          type: integer
          minimum: 1
      required:
      - skuId
      - qty
    CartImportJob:
      allOf:
      - "$ref": "#/components/schemas/ImportJob"
      - type: object
        properties:
          result:
            "$ref": "#/components/schemas/CartImportResult"
    CartImportResult:
      type: object
      properties:
        autoAddedCount:
          type: integer
          minimum: 0
        pendingCount:
          type: integer
          minimum: 0
        autoAddedItems:
          type: array
          items:
            "$ref": "#/components/schemas/CartImportAddedItem"
        pendingItems:
          type: array
          items:
            "$ref": "#/components/schemas/CartImportPendingItem"
      required:
      - autoAddedCount
      - pendingCount
      - autoAddedItems
      - pendingItems
    CartImportAddedItem:
      type: object
      properties:
        rowNo:
          type: integer
          minimum: 1
        skuId:
          type: string
          format: uuid
        qty:
          type: integer
          minimum: 1
      required:
      - rowNo
      - skuId
      - qty
    CartImportPendingItem:
      type: object
      properties:
        rowNo:
          type: integer
          minimum: 1
        rawName:
          type: string
        rawSpec:
          type: string
          nullable: true
        rawQty:
          type: string
          nullable: true
        matchType:
          type: string
          enum:
          - AMBIGUOUS
          - NOT_FOUND
        candidates:
          type: array
          items:
            "$ref": "#/components/schemas/CartImportCandidate"
      required:
      - rowNo
      - rawName
      - matchType
      - candidates
    CartImportCandidate:
      type: object
      properties:
        sku:
          "$ref": "#/components/schemas/SKU"
      required:
      - sku
    ConfirmCartImportRequest:
      type: object
      properties:
        selections:
          type: array
          items:
            "$ref": "#/components/schemas/CartImportSelection"
      required:
      - selections
    CartImportSelection:
      type: object
      properties:
        rowNo:
          type: integer
          minimum: 1
        skuId:
          type: string
          format: uuid
        qty:
          type: integer
          minimum: 1
          nullable: true
      required:
      - rowNo
      - skuId
    Address:
      type: object
      properties:
        receiverName:
          type: string
        receiverPhone:
          type: string
        province:
          type: string
        city:
          type: string
        district:
          type: string
        detail:
          type: string
      required:
      - receiverName
      - receiverPhone
      - detail
    CreateOrderRequest:
      type: object
      properties:
        address:
          "$ref": "#/components/schemas/Address"
        remark:
          type: string
        items:
          type: array
          items:
            type: object
            properties:
              skuId:
                type: string
                format: uuid
              qty:
                type: integer
                minimum: 1
            required:
            - skuId
            - qty
      required:
      - address
      - items
    OrderStatus:
      type: string
      enum:
      - SUBMITTED
      - CONFIRMED
      - PAY_PENDING
      - PAID
      - PAY_FAILED
      - SHIPPED
      - DELIVERED
      - CANCELLED
      - CLOSED
    OrderItem:
      type: object
      properties:
        sku:
          "$ref": "#/components/schemas/SKU"
        qty:
          type: integer
          minimum: 1
        unitPrice:
          type: number
          description: Final price per unit at order time
      required:
      - sku
      - qty
    Order:
      type: object
      properties:
        id:
          type: string
          format: uuid
        status:
          "$ref": "#/components/schemas/OrderStatus"
        address:
          "$ref": "#/components/schemas/Address"
        items:
          type: array
          items:
            "$ref": "#/components/schemas/OrderItem"
        remark:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
      - id
      - status
      - items
      - createdAt
    PagedOrderList:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/Order"
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
      required:
      - items
      - page
      - pageSize
      - total
    TrackingInfo:
      type: object
      properties:
        orderId:
          type: string
          format: uuid
        shipments:
          type: array
          items:
            type: object
            properties:
              carrier:
                type: string
                nullable: true
              waybillNo:
                type: string
              shippedAt:
                type: string
                format: date-time
                nullable: true
            required:
            - waybillNo
      required:
      - orderId
      - shipments
    UpdateTrackingRequest:
      type: object
      properties:
        shipments:
          type: array
          items:
            type: object
            properties:
              carrier:
                type: string
                nullable: true
              waybillNo:
                type: string
              shippedAt:
                type: string
                format: date-time
                nullable: true
            required:
            - waybillNo
      required:
      - shipments
    CreateProductRequest:
      type: object
      properties:
        name:
          type: string
        spec:
          type: string
        qty:
          type: string
          description: Free-form, e.g., '10 boxes' or '5 pcs'
        note:
          type: string
      required:
      - name
    ProductRequest:
      type: object
      properties:
        id:
          type: string
          format: uuid
        createdByUserId:
          type: string
          format: uuid
        name:
          type: string
        spec:
          type: string
        qty:
          type: string
        note:
          type: string
        createdAt:
          type: string
          format: date-time
      required:
      - id
      - createdByUserId
      - name
      - createdAt
    PagedProductRequestList:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/ProductRequest"
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
      required:
      - items
      - page
      - pageSize
      - total
    CreateAfterSalesTicket:
      type: object
      properties:
        orderId:
          type: string
          format: uuid
          nullable: true
        subject:
          type: string
        description:
          type: string
        attachments:
          type: array
          items:
            type: string
            description: Uploaded file URL
      required:
      - subject
      - description
    TicketStatus:
      type: string
      enum:
      - OPEN
      - IN_PROGRESS
      - RESOLVED
      - CLOSED
    AfterSalesTicket:
      type: object
      properties:
        id:
          type: string
          format: uuid
        status:
          "$ref": "#/components/schemas/TicketStatus"
        orderId:
          type: string
          format: uuid
          nullable: true
        assignedStaffUserId:
          type: string
          format: uuid
          nullable: true
        subject:
          type: string
        description:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          nullable: true
      required:
      - id
      - status
      - subject
      - description
      - createdAt
    UpdateAfterSalesTicketRequest:
      type: object
      properties:
        status:
          "$ref": "#/components/schemas/TicketStatus"
        assignedStaffUserId:
          type: string
          format: uuid
          nullable: true
      additionalProperties: false
    PagedAfterSalesTicketList:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/AfterSalesTicket"
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
      required:
      - items
      - page
      - pageSize
      - total
    CreateTicketMessage:
      type: object
      properties:
        content:
          type: string
      required:
      - content
    MessageSenderType:
      type: string
      enum:
      - customer
      - staff
      - ai
    AfterSalesMessage:
      type: object
      properties:
        id:
          type: string
          format: uuid
        ticketId:
          type: string
          format: uuid
        senderType:
          "$ref": "#/components/schemas/MessageSenderType"
        senderUserId:
          type: string
          format: uuid
          nullable: true
        content:
          type: string
        createdAt:
          type: string
          format: date-time
      required:
      - id
      - ticketId
      - senderType
      - content
      - createdAt
    PagedAfterSalesMessageList:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/AfterSalesMessage"
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
      required:
      - items
      - page
      - pageSize
      - total
    CreatePriceInquiry:
      type: object
      properties:
        skuId:
          type: string
          format: uuid
          nullable: true
        orderId:
          type: string
          format: uuid
          nullable: true
        message:
          type: string
      required:
      - message
    PriceInquiry:
      type: object
      properties:
        id:
          type: string
          format: uuid
        createdByUserId:
          type: string
          format: uuid
        assignedSalesUserId:
          type: string
          format: uuid
          nullable: true
        skuId:
          type: string
          format: uuid
          nullable: true
        orderId:
          type: string
          format: uuid
          nullable: true
        message:
          type: string
        status:
          type: string
          enum:
          - OPEN
          - RESPONDED
          - CLOSED
        responseNote:
          type: string
          nullable: true
          description: Optional summary note; detailed replies via messages
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          nullable: true
      required:
      - id
      - createdByUserId
      - message
      - status
      - createdAt
    UpdatePriceInquiryRequest:
      type: object
      properties:
        status:
          type: string
          enum:
          - OPEN
          - RESPONDED
          - CLOSED
        assignedSalesUserId:
          type: string
          format: uuid
          nullable: true
        responseNote:
          type: string
          nullable: true
          description: Optional summary note; detailed replies via messages
      additionalProperties: false
    PagedPriceInquiryList:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/PriceInquiry"
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
      required:
      - items
      - page
      - pageSize
      - total
    CreateInquiryMessage:
      type: object
      properties:
        content:
          type: string
      required:
      - content
    InquiryMessage:
      type: object
      properties:
        id:
          type: string
          format: uuid
        inquiryId:
          type: string
          format: uuid
        senderType:
          "$ref": "#/components/schemas/MessageSenderType"
        senderUserId:
          type: string
          format: uuid
          nullable: true
        content:
          type: string
        createdAt:
          type: string
          format: date-time
      required:
      - id
      - inquiryId
      - senderType
      - content
      - createdAt
    PagedInquiryMessageList:
      type: object
      properties:
        items:
          type: array
          items:
            "$ref": "#/components/schemas/InquiryMessage"
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
      required:
      - items
      - page
      - pageSize
      - total
    AIReplySuggestionRequest:
      type: object
      properties:
        ticketId:
          type: string
          format: uuid
        latestMessageId:
          type: string
          format: uuid
          nullable: true
      required:
      - ticketId
    AIReplySuggestions:
      type: object
      properties:
        ticketId:
          type: string
          format: uuid
        suggestions:
          type: array
          items:
            type: string
        generatedAt:
          type: string
          format: date-time
      required:
      - ticketId
      - suggestions
      - generatedAt
    JobStatus:
      type: string
      enum:
      - PENDING
      - RUNNING
      - SUCCEEDED
      - FAILED
    ImportJob:
      type: object
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          enum:
          - PRODUCT_IMPORT
          - PRODUCT_REQUEST_EXPORT
          - SHIPMENT_IMPORT
          - CART_IMPORT
        status:
          "$ref": "#/components/schemas/JobStatus"
        progress:
          type: integer
          minimum: 0
          maximum: 100
        resultFileUrl:
          type: string
          nullable: true
        errorReportUrl:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
      required:
      - id
      - type
      - status
      - progress
      - createdAt
    FeatureFlags:
      type: object
      properties:
        paymentEnabled:
          type: boolean
          default: false
        wechatPayEnabled:
          type: boolean
          default: false
        alipayPayEnabled:
          type: boolean
          default: false
      additionalProperties: false
    WechatPayCreateResponse:
      type: object
      properties:
        orderId:
          type: string
          format: uuid
        prepayId:
          type: string
        nonceStr:
          type: string
        timeStamp:
          type: string
        paySign:
          type: string
      required:
      - orderId
      - prepayId
      - nonceStr
      - timeStamp
      - paySign
    AlipayPayCreateResponse:
      type: object
      properties:
        orderId:
          type: string
          format: uuid
        tradeNo:
          type: string
        payParams:
          type: object
          additionalProperties: true
      required:
      - orderId
      - tradeNo
      - payParams
